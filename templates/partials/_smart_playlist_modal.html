<!-- Smart Playlist Settings Modal -->
<div x-show="isSmartPlaylistModalOpen" @keydown.escape.window="closeSmartPlaylistSettings()"
    class="fixed inset-0 z-[60] flex items-center justify-center overflow-y-auto bg-black/80 p-4" x-cloak>
    
    <div class="fixed inset-0" @click="closeSmartPlaylistSettings()" x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"></div>

    <div class="relative z-10 w-full max-w-2xl overflow-hidden rounded-lg bg-[#111827] shadow-xl"
        x-show="isSmartPlaylistModalOpen" 
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" 
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        @click.outside="closeSmartPlaylistSettings()">
        
        <template x-if="currentSmartPlaylist">
            <div x-data="smartPlaylistEditor(currentSmartPlaylist, allAuthorsForFilter)">
                <div class="flex items-center justify-between p-4 border-b border-[var(--divider-color)]">
                    <h3 class="text-lg font-semibold text-[var(--text-bright)]">
                        Smart Playlist: <span x-text="currentSmartPlaylist.name"></span>
                    </h3>
                    <button @click="closeSmartPlaylistSettings()" class="p-1 -m-1 text-[var(--text-secondary)] hover:text-red-500" title="Close">
                        <i class="material-icons" style="font-size: 20px;">close</i>
                    </button>
                </div>
    
                <!-- This is the new UI -->
                <div class="p-6 space-y-6 max-h-[70vh] overflow-y-auto">
                    
                    <!-- Section 1: Author Checkboxes -->
                    <div>
                        <h4 class="text-sm font-semibold text-[var(--text-highlight)] mb-2">Filter by Author / Channel</h4>
                        <div class="p-4 rounded-lg bg-[var(--bg-medium)] max-h-60 overflow-y-auto space-y-2 pr-2 border border-[var(--divider-color)]">
                            <template x-for="author in allAuthors" :key="author">
                                <label class="flex items-center gap-3 p-2 rounded-md hover:bg-[var(--bg-highlight)]/50 cursor-pointer">
                                    <input type="checkbox" 
                                        class="rounded bg-[var(--bg-darkest)] border-[var(--divider-color)] text-[var(--text-highlight)] focus:ring-[var(--highlight-ring)]"
                                        :value="author"
                                        x-model="checkedAuthors">
                                    <span class="text-sm font-medium text-[var(--text-main)]" x-text="author"></span>
                                </label>
                            </template>
                            <p x-show="allAuthors.length === 0" class="text-sm italic text-[var(--text-secondary)]">
                                Loading authors...
                            </p>
                        </div>
                    </div>

                    <!-- Section 2: Advanced Rules -->
                    <div>
                        <h4 class="text-sm font-semibold text-[var(--text-highlight)] mb-2">Advanced Rules</h4>
                        
                        <!-- List of existing advanced rules -->
                        <div class="space-y-2 mb-3" x-show="otherFilters.length > 0">
                            <template x-for="filter in otherFilters" :key="filter.id">
                                <div class="flex items-center justify-between p-2 rounded-md bg-[var(--bg-medium)] border border-[var(--divider-color)]">
                                    <span class="text-sm text-[var(--text-main)]" x-text="getRuleLabel(filter)"></span>
                                    <button @click="removeRule(filter.id)" class="p-1 -m-1 text-red-500 hover:text-red-400" title="Remove rule">
                                        <i class="material-icons" style="font-size: 18px;">close</i>
                                    </button>
                                </div>
                            </template>
                        </div>
                         <p x-show="otherFilters.length === 0" class="text-sm italic text-[var(--text-secondary)] mb-3">
                           No advanced rules added yet.
                         </p>

                        <!-- Form to add a new advanced rule -->
                        <div class="p-4 rounded-lg bg-[var(--bg-medium)] space-y-3 border border-dashed border-[var(--divider-color)]">
                            <select x-model="newRuleType" class="w-full rounded-md border-[var(--divider-color)] bg-[var(--bg-darkest)] text-sm text-[var(--text-bright)] p-1.5 focus:border-[var(--highlight-ring)] focus:ring-[var(--highlight-ring)]">
                                <option value="title">Title Keyword</option>
                                <option value="duration">Duration</option>
                            </select>

                            <template x-if="newRuleType === 'title'">
                                <input type="text" x-model="newRuleValue"
                                    class="w-full rounded-md border-[var(--divider-color)] bg-[var(--bg-darkest)] text-sm text-[var(--text-bright)] p-1.5"
                                    placeholder="e.g. review, tutorial (comma-separated)">
                            </template>

                            <template x-if="newRuleType === 'duration'">
                                <div class="flex items-center gap-2">
                                    <select x-model="newRuleOperator" class="rounded-md border-[var(--divider-color)] bg-[var(--bg-darkest)] text-sm text-[var(--text-bright)] p-1.5 focus:border-[var(--highlight-ring)] focus:ring-[var(--highlight-ring)]">
                                        <option value="gt">Greater than</option>
                                        <option value="lt">Less than</option>
                                    </select>
                                    <input type="number" x-model.number="newRuleDuration" min="0" class="w-24 rounded-md border-[var(--divider-color)] bg-[var(--bg-darkest)] text-sm text-[var(--text-bright)] p-1.5">
                                    <select x-model="newRuleDurationUnit" class="rounded-md border-[var(--divider-color)] bg-[var(--bg-darkest)] text-sm text-[var(--text-bright)] p-1.5 focus:border-[var(--highlight-ring)] focus:ring-[var(--highlight-ring)]">
                                        <option value="minutes">minutes</option>
                                        <option value="seconds">seconds</option>
                                        <option value="hours">hours</option>
                                    </select>
                                </div>
                            </template>

                            <button @click="addRule()" class="w-full rounded-md bg-gray-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-gray-500 transition-colors">
                                Add Rule
                            </button>
                        </div>
                    </div>
                </div>
    
                <div class="p-4 bg-[var(--bg-medium)] border-t border-[var(--divider-color)] flex justify-end gap-2">
                    <button @click="closeSmartPlaylistSettings()" class="rounded-md bg-gray-600 px-4 py-2 text-sm font-medium text-white hover:bg-gray-500">
                        Cancel
                    </button>
                    <button @click="saveSettings()" class="rounded-md bg-[var(--text-highlight)] px-4 py-2 text-sm font-medium text-[var(--bg-darkest)] hover:bg-opacity-80">
                        Save Changes
                    </button>
                </div>
            </div>
        </template>
    </div>
</div>