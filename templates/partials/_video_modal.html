<div x-show="isModalOpen" @keydown.escape.window="closeModal()"
    class="fixed inset-0 z-50 flex items-start justify-center overflow-y-auto bg-black/80 p-4 pt-12 sm:p-8" x-cloak>
    <div class="fixed inset-0" @click="closeModal()" x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"></div>

    <div class="relative z-10 w-full max-w-5xl overflow-hidden rounded-lg bg-[#111827] shadow-xl"
        x-show="isModalOpen" x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">

        <button
            class="absolute top-2 right-2 z-20 p-1 text-[var(--text-secondary)] hover:text-[var(--text-bright)] transition-colors"
            @click="closeModal()" title="Close Player">
            <i class="material-icons" style="font-size: 24px;">cancel</i>
        </button>

        <template x-if="modalVideo">
            <div x-data="{ isMoreMenuOpen: false }">
                <div class="relative">
                    <div class="p-0 bg-black relative z-10 flex justify-center min-h-[300px]">
                        
                        <template x-if="modalVideo.media_type === 'video'">
                            <video id="main-video-player"
                                class="w-full max-h-[80vh] h-auto relative z-10" :src="currentVideoSrc" controls
                                autoplay @ended="handleVideoEnd()" x-ref="videoPlayer" crossorigin="anonymous"
                                @enterpictureinpicture="handleEnterPiP()" @leavepictureinpicture="handleLeavePiP()">
                                <template x-if="modalVideo.subtitle_url">
                                    <track :label="modalVideo.subtitle_label" kind="subtitles"
                                        :src="modalVideo.subtitle_url" :srclang="modalVideo.subtitle_lang">
                                </template>
                                Your browser does not support the video tag.
                            </video>
                        </template>

                        <template x-if="modalVideo.media_type === 'image'">
                            <img :src="currentVideoSrc" 
                                 class="max-h-[80vh] w-auto max-w-full object-contain relative z-10" 
                                 alt="Full screen view">
                        </template>

                    </div>
                    <div
                        class="absolute bottom-0 left-[10%] w-[80%] h-8 bg-white blur-3xl opacity-40 transform translate-y-1/2">
                    </div>
                </div>

                <div class="p-4 sm:p-5">
                    <div class="lg:flex lg:gap-x-8">
                        <div class="lg:w-2/3">
                            <div class="flex items-center gap-3">
                                <template x-if="modalVideo.show_poster_url">
                                    <img :src="modalVideo.show_poster_url" alt="Show Poster"
                                        class="w-12 h-12 object-cover rounded-lg flex-shrink-0">
                                </template>
                                <div>
                                    <a href="#" @click.prevent="navigateToAuthorFilter(modalVideo.author)"
                                        class="text-sm font-bold text-[var(--text-highlight)] hover:underline"
                                        x-text="modalVideo.author || 'Unknown Author'">
                                    </a>
                                    <span class="block text-sm text-[var(--text-secondary)]"
                                        x-text="getAuthorVideoCount(modalVideo.author)">
                                    </span>
                                </div>
                            </div>

                            <div class="mt-4 border-t border-[var(--divider-color)] pt-4">
                                <h2 class="text-2xl font-bold text-[var(--text-bright)] tracking-tight leading-tight"
                                    style="text-wrap: balance;" x-text="modalVideo.title">
                                </h2>
                            </div>

                            <div class="mt-2 text-xs text-[var(--text-secondary)]"
                                x-text="formatDateAgo(modalVideo.published, modalVideo.uploaded)">
                            </div>

                            <div class="lg:hidden mt-4" x-show="modalVideo.media_type === 'video'">
                                <div class="grid grid-cols-6 gap-2 mb-2">
                                    <button @click.prevent="playPreviousVideo()" title="Previous Video"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">skip_previous</i>
                                    </button>
                                    <button @click.prevent="previousFrame()" title="Previous Frame"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">chevron_left</i>
                                    </button>
                                    <button @click.prevent="$refs.videoPlayer.currentTime -= 5" title="Seek Back 5s"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">fast_rewind</i>
                                    </button>
                                    <button @click.prevent="$refs.videoPlayer.currentTime += 10"
                                        title="Seek Forward 10s"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">fast_forward</i>
                                    </button>
                                    <button @click.prevent="nextFrame()" title="Next Frame"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">chevron_right</i>
                                    </button>
                                    <button @click.prevent="playNextVideo()" title="Next Video"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">skip_next</i>
                                    </button>
                                </div>

                                <div class="grid grid-cols-4 gap-2 mb-2">
                                    <button
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                        @click.prevent="toggleBookmark(modalVideo)" title="Watch Later">
                                        <i class="material-icons" style="font-size: 20px;"
                                            x-text="modalVideo.is_read_later ? 'watch_later' : 'schedule'"></i>
                                    </button>
                                    <button
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                        @click.prevent="toggleFavorite(modalVideo)" title="Favorite">
                                        <i class="material-icons" style="font-size: 20px;"
                                            x-text="modalVideo.is_favorite ? 'star' : 'star_border'"></i>
                                    </button>
                                    <button @click.prevent="openPlaylistModal(modalVideo.id)" title="Add to Playlist"
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">playlist_add</i>
                                    </button>
                                    <a :href="modalVideo.video_url" :download="modalVideo.filename"
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                        title="Download original file">
                                        <i class="material-icons" style="font-size: 20px;">download</i>
                                    </a>
                                </div>

                                <div class="grid grid-cols-2 gap-2">
                                    <button
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                        @click.prevent="cyclePlaybackSpeed()" title="Change Playback Speed">
                                        <i class="material-icons" style="font-size: 20px;">speed</i>
                                        <span x-text="currentPlaybackSpeed.toFixed(2) + 'x'"></span>
                                    </button>
                                    
                                    <div class="relative">
                                        <button @click="isMoreMenuOpen = !isMoreMenuOpen" class="w-full flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons">more_vert</i>
                                            <span>More Actions</span>
                                        </button>
                                        <div x-show="isMoreMenuOpen" @click.outside="isMoreMenuOpen = false"
                                            x-transition:enter="transition ease-out duration-100"
                                            x-transition:enter-start="opacity-0 scale-95"
                                            x-transition:enter-end="opacity-100 scale-100"
                                            x-transition:leave="transition ease-in duration-75"
                                            x-transition:leave-start="opacity-100 scale-100"
                                            x-transition:leave-end="opacity-0 scale-95"
                                            class="absolute bottom-full right-0 z-10 mb-2 w-56 origin-bottom-right rounded-md bg-[var(--bg-darkest)] shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                            x-cloak>
                                            <div class="py-1" role="none">
                                                <a href="#" @click.prevent="document.getElementById('more-info-panel').scrollIntoView({ behavior: 'smooth' }); isMoreMenuOpen = false" class="text-[var(--text-main)] hover:bg-[var(--bg-highlight)] flex items-center gap-2 px-4 py-2 text-sm w-full text-left">
                                                    <i class="material-icons" style="font-size: 20px;">info</i>
                                                    <span>More Info</span>
                                                </a>
                                                <template x-if="modalVideo.media_type === 'video'">
                                                    <div>
                                                        <template x-if="!modalVideo.has_custom_thumb && !isCreatingThumb">
                                                            <button @click.prevent="createCustomThumb(); isMoreMenuOpen = false" class="w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-main)] hover:bg-[var(--bg-highlight)]">
                                                                <i class="material-icons" style="font-size: 20px;">add_photo_alternate</i>
                                                                <span>Create Thumb</span>
                                                            </button>
                                                        </template>
                                                        <template x-if="modalVideo.has_custom_thumb && !isCreatingThumb">
                                                            <button @click.prevent="deleteCustomThumb(); isMoreMenuOpen = false" class="w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-main)] hover:bg-[var(--bg-highlight)]">
                                                                <i class="material-icons" style="font-size: 20px;">delete_outline</i>
                                                                <span>Remove Thumb</span>
                                                            </button>
                                                        </template>
                                                        
                                                        <div class="border-t border-[var(--divider-color)] my-1"></div>

                                                        <template x-if="!modalVideo.has_transcode && !isOptimizing(modalVideo.id)">
                                                            <button @click.prevent="startTranscode(modalVideo); isMoreMenuOpen = false" class="w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-main)] hover:bg-[var(--bg-highlight)]">
                                                                <i class="material-icons" style="font-size: 20px;">movie_filter</i>
                                                                <span>Optimize</span>
                                                            </button>
                                                        </template>
                                                        
                                                        </div>
                                                </template>
                                                
                                                <template x-if="modalVideo.youtube_id">
                                                    <a :href="'https://www.youtube.com/watch?v=' + modalVideo.youtube_id" target="_blank" class="text-[var(--text-main)] hover:bg-[var(--bg-highlight)] yt-icon flex items-center gap-2 px-4 py-2 text-sm">
                                                        <i class="material-icons" style="font-size: 20px;">smart_display</i>
                                                        <span>YouTube</span>
                                                    </a>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-4 bg-[#0b101a] rounded-2xl p-5">
                                <div class="prose prose-sm prose-invert max-w-none text-[var(--text-main)] prose-p:font-sm"
                                    style="overflow-wrap: break-word;"
                                    x-html="formatVideoDescription(modalVideo.summary || 'No summary available.')">
                                </div>
                            </div>

                            <div id="more-info-panel"
                                class="mt-4 border-t border-[var(--divider-color)] pt-4 text-[var(--text-main)]"
                                x-cloak>
                                <div class="prose prose-sm prose-invert max-w-none space-y-3">
                                    <div>
                                        <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Filename</h4>
                                        <p class="!mt-0.5 break-words" x-text="modalVideo.filename"></p>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Path</h4>
                                        <p class="!mt-0.5 break-words" x-text="modalVideo.relative_path"></p>
                                    </div>
                                    <div class="grid grid-cols-5 gap-x-4">
                                        <div>
                                            <h4 class="font-semibold text-[var(--text-secondary)] !m-0">File Size</h4>
                                            <p class="!mt-0.5" x-text="formatFileSize(modalVideo.file_size)"></p>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Format</h4>
                                            <p class="!mt-0.5" x-text="modalVideo.file_format"></p>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Dimensions</h4>
                                            <p class="!mt-0.5" x-text="modalVideo.dimensions || 'Unknown'"></p>
                                        </div>
                                        <div x-show="modalVideo.media_type === 'video'">
                                            <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Length</h4>
                                            <p class="!mt-0.5" x-text="formatDuration(modalVideo.duration) || 'N/A'"></p>
                                        </div>
                                        <div x-show="modalVideo.media_type === 'video'">
                                            <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Codec</h4>
                                            <p class="!mt-0.5" x-text="modalVideo.video_codec || 'N/A'"></p>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Associated Files</h4>
                                        <div class="!mt-0.5 flex flex-wrap gap-x-3 gap-y-1">
                                            <span class="inline-flex items-center gap-1">
                                                <i class="material-icons text-[var(--text-highlight)]" style="font-size: 16px;">
                                                    <span x-text="modalVideo.media_type === 'video' ? 'videocam' : 'image'"></span>
                                                </i>
                                                <span x-text="modalVideo.file_format"></span>
                                            </span>
                                            <template x-if="modalVideo.has_subtitle">
                                                <span class="inline-flex items-center gap-1">
                                                    <i class="material-icons text-[var(--text-highlight)]" style="font-size: 16px;">subtitles</i>
                                                    <span>SRT</span>
                                                </span>
                                            </template>
                                            <template x-if="modalVideo.has_thumbnail">
                                                <span class="inline-flex items-center gap-1">
                                                    <i class="material-icons text-[var(--text-highlight)]" style="font-size: 16px;">image</i>
                                                    <span>JPG</span>
                                                </span>
                                            </template>
                                            <template x-if="modalVideo.has_nfo">
                                                <span class="inline-flex items-center gap-1">
                                                    <i class="material-icons text-[var(--text-highlight)]" style="font-size: 16px;">description</i>
                                                    <span>NFO</span>
                                                </span>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="hidden lg:block lg:w-1/3 lg:mt-0" x-show="modalVideo.media_type === 'video'">
                            <div class="grid grid-cols-6 gap-2 mb-2">
                                <button @click.prevent="playPreviousVideo()" title="Previous Video"
                                    class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                    <i class="material-icons" style="font-size: 20px;">skip_previous</i>
                                </button>
                                <button @click.prevent="previousFrame()" title="Previous Frame"
                                    class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                    <i class="material-icons" style="font-size: 20px;">chevron_left</i>
                                </button>
                                <button @click.prevent="$refs.videoPlayer.currentTime -= 5" title="Seek Back 5s"
                                    class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                    <i class="material-icons" style="font-size: 20px;">fast_rewind</i>
                                </button>
                                <button @click.prevent="$refs.videoPlayer.currentTime += 10"
                                    title="Seek Forward 10s"
                                    class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                    <i class="material-icons" style="font-size: 20px;">fast_forward</i>
                                </button>
                                <button @click.prevent="nextFrame()" title="Next Frame"
                                    class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                    <i class="material-icons" style="font-size: 20px;">chevron_right</i>
                                </button>
                                <button @click.prevent="playNextVideo()" title="Next Video"
                                    class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                    <i class="material-icons" style="font-size: 20px;">skip_next</i>
                                </button>
                            </div>

                            <div class="grid grid-cols-4 gap-2 mb-2">
                                <button
                                    class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                    @click.prevent="toggleBookmark(modalVideo)" title="Watch Later">
                                    <i class="material-icons" style="font-size: 20px;"
                                        x-text="modalVideo.is_read_later ? 'watch_later' : 'schedule'"></i>
                                </button>
                                <button
                                    class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                    @click.prevent="toggleFavorite(modalVideo)" title="Favorite">
                                    <i class="material-icons" style="font-size: 20px;"
                                        x-text="modalVideo.is_favorite ? 'star' : 'star_border'"></i>
                                </button>
                                <button @click.prevent="openPlaylistModal(modalVideo.id)" title="Add to Playlist"
                                    class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                    <i class="material-icons" style="font-size: 20px;">playlist_add</i>
                                </button>
                                <a :href="modalVideo.video_url" :download="modalVideo.filename"
                                    class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                    title="Download original file">
                                    <i class="material-icons" style="font-size: 20px;">download</i>
                                </a>
                            </div>

                            <div class="grid grid-cols-2 gap-2">
                                <button
                                    class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                    @click.prevent="cyclePlaybackSpeed()" title="Change Playback Speed">
                                    <i class="material-icons" style="font-size: 20px;">speed</i>
                                    <span x-text="currentPlaybackSpeed.toFixed(2) + 'x'"></span>
                                </button>
                                
                                <div class="relative">
                                    <button @click="isMoreMenuOpen = !isMoreMenuOpen" class="w-full flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons">more_vert</i>
                                        <span>More Actions</span>
                                    </button>
                                    <div x-show="isMoreMenuOpen" @click.outside="isMoreMenuOpen = false"
                                        x-transition:enter="transition ease-out duration-100"
                                        x-transition:enter-start="opacity-0 scale-95"
                                        x-transition:enter-end="opacity-100 scale-100"
                                        x-transition:leave="transition ease-in duration-75"
                                        x-transition:leave-start="opacity-100 scale-100"
                                        x-transition:leave-end="opacity-0 scale-95"
                                        class="absolute top-full right-0 z-10 mt-2 w-56 origin-top-right rounded-md bg-[var(--bg-darkest)] shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                                        x-cloak>
                                        <div class="py-1" role="none">
                                            <a href="#" @click.prevent="document.getElementById('more-info-panel').scrollIntoView({ behavior: 'smooth' }); isMoreMenuOpen = false" class="text-[var(--text-main)] hover:bg-[var(--bg-highlight)] flex items-center gap-2 px-4 py-2 text-sm w-full text-left">
                                                <i class="material-icons" style="font-size: 20px;">info</i>
                                                <span>More Info</span>
                                            </a>
                                            <template x-if="modalVideo.media_type === 'video'">
                                                <div>
                                                    <template x-if="!modalVideo.has_custom_thumb && !isCreatingThumb">
                                                        <button @click.prevent="createCustomThumb(); isMoreMenuOpen = false" class="w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-main)] hover:bg-[var(--bg-highlight)]">
                                                            <i class="material-icons" style="font-size: 20px;">add_photo_alternate</i>
                                                            <span>Create Thumb</span>
                                                        </button>
                                                    </template>
                                                    <template x-if="modalVideo.has_custom_thumb && !isCreatingThumb">
                                                        <button @click.prevent="deleteCustomThumb(); isMoreMenuOpen = false" class="w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-main)] hover:bg-[var(--bg-highlight)]">
                                                            <i class="material-icons" style="font-size: 20px;">delete_outline</i>
                                                            <span>Remove Thumb</span>
                                                        </button>
                                                    </template>
                                                    <template x-if="isCreatingThumb">
                                                        <span class="flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-secondary)] opacity-70">
                                                            <i class="material-icons animate-spin" style="font-size: 20px;">sync</i>
                                                            <span>Working...</span>
                                                        </span>
                                                    </template>
                                                    
                                                    <div class="border-t border-[var(--divider-color)] my-1"></div>

                                                    <template x-if="!modalVideo.has_transcode && !isOptimizing(modalVideo.id)">
                                                        <button @click.prevent="startTranscode(modalVideo); isMoreMenuOpen = false" class="w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-main)] hover:bg-[var(--bg-highlight)]">
                                                            <i class="material-icons" style="font-size: 20px;">movie_filter</i>
                                                            <span>Optimize</span>
                                                        </button>
                                                    </template>
                                                    <template x-if="isCurrentlyTranscoding(modalVideo.id)">
                                                        <span class="flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-secondary)] opacity-70">
                                                            <i class="material-icons animate-spin" style="font-size: 20px;">sync</i>
                                                            <span>Optimizing...</span>
                                                        </span>
                                                    </template>
                                                    <template x-if="isQueued(modalVideo.id)">
                                                        <span class="flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-secondary)] opacity-70">
                                                            <i class="material-icons" style="font-size: 20px;">hourglass_top</i>
                                                            <span>Queued</span>
                                                        </span>
                                                    </template>
                                                    <template x-if="modalVideo.has_transcode && !isOptimizing(modalVideo.id)">
                                                        <button @click.prevent="deleteTranscode(modalVideo); isMoreMenuOpen = false" class="w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-main)] hover:bg-[var(--bg-highlight)]">
                                                            <i class="material-icons" style="font-size: 20px;">delete_outline</i>
                                                            <span>Remove Optimized</span>
                                                        </button>
                                                    </template>
                                                    <template x-if="modalVideo.has_transcode">
                                                        <a :href="modalVideo.transcode_download_url" class="flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-main)] hover:bg-[var(--bg-highlight)]" title="Download optimized MP4">
                                                            <i class="material-icons" style="font-size: 20px;">download_for_offline</i>
                                                            <span>Download Optimized</span>
                                                        </a>
                                                    </template>

                                                    <div class="border-t border-[var(--divider-color)] my-1"></div>
                                                    
                                                    <button @click.prevent="cycleVideoTag(modalVideo); isMoreMenuOpen = false" class="w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-[var(--text-main)] hover:bg-[var(--bg-highlight)]">
                                                        <i class="material-icons" style="font-size: 20px;" x-text="getVideoTagIcon(modalVideo)"></i>
                                                        <span x-text="getVideoTagText(modalVideo)"></span>
                                                    </button>
                                                </div>
                                            </template>
                                            <template x-if="modalVideo.youtube_id">
                                                <a :href="'https://www.youtube.com/watch?v=' + modalVideo.youtube_id" target="_blank" class="text-[var(--text-main)] hover:bg-[var(--bg-highlight)] yt-icon flex items-center gap-2 px-4 py-2 text-sm">
                                                    <i class="material-icons" style="font-size: 20px;">smart_display</i>
                                                    <span>YouTube</span>
                                                </a>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>
</div>