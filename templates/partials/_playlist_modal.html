<!-- Add to Playlist Modal -->
<div x-show="isPlaylistModalOpen" @keydown.escape.window="isPlaylistModalOpen = false"
    class="fixed inset-0 z-[60] flex items-center justify-center overflow-y-auto bg-black/80 p-4" x-cloak>
    
    <div class="fixed inset-0" @click="isPlaylistModalOpen = false" x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"></div>

    <div class="relative z-10 w-full max-w-md overflow-hidden rounded-lg bg-[#111827] shadow-xl"
        x-show="isPlaylistModalOpen" 
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" 
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        @click.outside="isPlaylistModalOpen = false">
        
        <div class="flex items-center justify-between p-4 border-b border-[var(--divider-color)]">
            <h3 class="text-lg font-semibold text-[var(--text-bright)]">Add to Playlist</h3>
            <button @click="isPlaylistModalOpen = false" class="p-1 -m-1 text-[var(--text-secondary)] hover:text-red-500" title="Close">
                <i class="material-icons" style="font-size: 20px;">close</i>
            </button>
        </div>

        <div class="p-4 space-y-3" x-data="{ newPlaylistName: '' }">
            <div class="flex items-center gap-2">
                <input type="text" x-model="newPlaylistName"
                    @keydown.enter="createStandardPlaylist(newPlaylistName, modalVideo.id); newPlaylistName=''"
                    placeholder="Create new playlist..."
                    class="flex-1 w-full rounded-md border border-[var(--divider-color)] bg-[var(--bg-darkest)] text-sm text-[var(--text-bright)] placeholder-[var(--text-secondary)] focus:border-[var(--highlight-ring)] focus:ring-[var(--highlight-ring)] p-1.5">
                <button @click="createStandardPlaylist(newPlaylistName, modalVideo.id); newPlaylistName=''"
                    :disabled="newPlaylistName.trim() === ''"
                    class="p-1 text-[var(--text-secondary)] transition-colors"
                    :class="{ 'hover:text-[var(--text-bright)]': newPlaylistName.trim() !== '', 'opacity-50 cursor-not-allowed': newPlaylistName.trim() === '' }"
                    title="Create and Add">
                    <i class="material-icons" style="font-size: 20px;">add</i>
                </button>
            </div>

            <div class="border-t border-[var(--divider-color)]"></div>

            <div class="max-h-60 overflow-y-auto space-y-2 pr-2">
                <template x-for="playlist in appData.standardPlaylists" :key="playlist.id">
                    <label class="flex items-center gap-3 p-2 rounded-md hover:bg-[var(--bg-highlight)]/50 cursor-pointer">
                        <input type="checkbox" 
                            class="rounded bg-[var(--bg-medium)] border-[var(--divider-color)] text-[var(--text-highlight)] focus:ring-[var(--highlight-ring)]"
                            :checked="playlist.is_in_playlist"
                            @change="toggleVideoInPlaylist(playlist.id, modalVideo.id)">
                        <span class="text-sm font-medium text-[var(--text-main)]" x-text="playlist.name"></span>
                    </label>
                </template>
                 <p x-show="appData.standardPlaylists.length === 0"
                    class="px-3 py-2 text-sm italic text-[var(--text-secondary)]">No playlists created yet.</p>
            </div>
        </div>
    </div>
</div>