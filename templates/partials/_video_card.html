<div class="flex flex-col overflow-hidden rounded-lg bg-[var(--bg-medium)] shadow-lg">

    <a href="#" @click.prevent="openModal(video)">
        <template x-if="video.image_url">
            <div class="aspect-box"
                :class="{ 'aspect-16-9': currentView.type !== 'shorts', 'aspect-9-16': currentView.type === 'shorts' }">
                <img class="absolute top-0 left-0 w-full h-full object-cover blur-lg scale-110 brightness-75"
                    :src="video.image_url" alt="" @error="$event.target.style.display='none'">
                <img class="absolute top-0 left-0 w-full h-full" :class="{
                        'object-contain': currentView.type !== 'shorts',
                        'object-cover': currentView.type === 'shorts'
                       }" :src="video.image_url" alt=""
                    @error="$event.target.style.display='none'; $event.target.nextElementSibling.style.display='flex'">
                <div
                    class="no-thumb-text hidden absolute top-0 left-0 w-full h-full items-center justify-center text-[var(--text-secondary)]">
                    (Image failed)</div>
                <template x-if="filterSettings.showDuration">
                    <div x-show="video.duration > 0"
                        class="absolute top-2 right-2 rounded-sm bg-black/70 px-1.5 py-0.5 text-xs font-semibold text-white">
                        <span x-text="formatDuration(video.duration)"></span>
                    </div>
                </template>
            </div>
        </template>
        <template x-if="!video.image_url">
            <div class="aspect-box"
                :class="{ 'aspect-16-9': currentView.type !== 'shorts', 'aspect-9-16': currentView.type === 'shorts' }">
                <div
                    class="absolute top-0 left-0 w-full h-full flex items-center justify-center text-[var(--text-secondary)]">
                    (No Thumbnail)</div>
            </div>
        </template>
    </a>

    <template x-if="filterSettings.showTitles">
        <div class="flex flex-1 flex-col justify-between p-5">
            <div class="flex-1">
                <h3 class="text-md font-semibold text-[var(--text-bright)] leading-tight"
                    style="text-wrap: balance;">
                    <a href="#" @click.prevent="openModal(video)" class="hover:underline"
                        x-text="video.title"></a>
                </h3>
            </div>
        </div>
    </template>

    <template x-if="filterSettings.showFooter">
        <div
            class="flex items-center justify-between gap-2 border-t border-[var(--divider-color)] p-3 px-5 bg-[#182030]">
            <div class="min-w-0 flex-1 text-sm text-[var(--text-secondary)]">
                <div class="flex items-center">
                    <a href="#" @click.prevent="setView('author', null, video.author)"
                        class="inline-block font-medium text-[var(--text-highlight)] px-2 py-0.5 rounded-full bg-[#233b4b] hover:bg-[#165357] transition-colors truncate flex-shrink"
                        x-text="video.author"></a>
                    <template x-if="video.is_short">
                        <a href="#"
                            @click.prevent.stop="currentView.type === 'shorts' ? setView('all') : setView('shorts')"
                            class="inline-block text-xs font-medium px-2 py-0.5 rounded-full ml-1.5 transition-colors flex-shrink-0"
                            style="color: #FEDA8B; background-color: transparent; border: 1px solid #e16c39;"
                            onmouseover="this.style.borderColor='#fff8e8'"
                            onmouseout="this.style.borderColor='#e16c39'"
                            :title="currentView.type === 'shorts' ? 'Clear Shorts filter' : 'Filter by Shorts'">
                            Short
                        </a>
                    </template>
                    <template x-if="video.has_transcode">
                        <a href="#"
                            @click.prevent.stop="currentView.type === 'optimized' ? setView('all') : setView('optimized')"
                            class="inline-block text-xs font-medium px-2 py-0.5 rounded-full ml-1.5 transition-colors flex-shrink-0"
                            style="color: #93c5fd; background-color: transparent; border: 1px solid #1e40af;"
                            onmouseover="this.style.borderColor='#dbeafe'"
                            onmouseout="this.style.borderColor='#1e40af'"
                            :title="currentView.type === 'optimized' ? 'Clear Optimized filter' : 'Filter by Optimized'">
                            Optimized
                        </a>
                    </template>
                    <template
                        x-if="video.video_type === 'VR180_SBS' || video.video_type === 'VR180_TB'">
                        <a href="#"
                            @click.prevent.stop="currentView.type === 'VR180' ? setView('all') : setView('VR180')"
                            class="inline-block text-xs font-medium px-2 py-0.5 rounded-full ml-1.5 transition-colors flex-shrink-0"
                            style="color: #f0abfc; background-color: transparent; border: 1px solid #701a75;"
                            onmouseover="this.style.borderColor='#f5d0fe'"
                            onmouseout="this.style.borderColor='#701a75'"
                            :title="currentView.type === 'VR180' ? 'Clear VR180 filter' : 'Filter by VR180'">
                            VR180
                        </a>
                    </template>
                    <template x-if="video.video_type === 'VR360'">
                        <a href="#"
                            @click.prevent.stop="currentView.type === 'VR360' ? setView('all') : setView('VR360')"
                            class="inline-block text-xs font-medium px-2 py-0.5 rounded-full ml-1.5 transition-colors flex-shrink-0"
                            style="color: #f0abfc; background-color: transparent; border: 1px solid #701a75;"
                            onmouseover="this.style.borderColor='#f5d0fe'"
                            onmouseout="this.style.borderColor='#701a75'"
                            :title="currentView.type === 'VR360' ? 'Clear VR360 filter' : 'Filter by VR360'">
                            VR360
                        </a>
                    </template>
                </div>
                <span class="block truncate text-xs mt-1 ml-2"
                    x-text="formatDateAgo(video.published, video.uploaded)"></span>
            </div>
            <div class="flex shrink-0 items-center gap-0">
                <button class="p-1" @click.prevent="toggleFavorite(video)"
                    :class="video.is_favorite ? 'text-[var(--text-highlight)]' : 'text-[var(--text-secondary)] hover:text-[var(--text-highlight)]'"><i
                        class="material-icons" style="font-size: 20px;"
                        x-text="video.is_favorite ? 'star' : 'star_border'"></i></button>
                <button class="p-1" @click.prevent="toggleBookmark(video)"
                    :class="video.is_read_later ? 'text-[var(--text-highlight)]' : 'text-[var(--text-secondary)] hover:text-[var(--text-highlight)]'"><i
                        class="material-icons" style="font-size: 20px;"
                        x-text="video.is_read_later ? 'watch_later' : 'schedule'"></i></button>
            </div>
        </div>
    </template>
</div>