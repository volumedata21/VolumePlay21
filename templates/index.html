<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VolumePlay21</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,line-clamp,typography,aspect-ratio"></script>
    
    <!-- === NEW JAVASCRIPT FILES === -->
    <!-- Load helpers and component logic first -->
    <script src="/static/js/app-helpers.js"></script>
    <script src="/static/js/app-state.js"></script>
    <script src="/static/js/app-logic-api.js"></script>
    <script src="/static/js/app-logic-tasks.js"></script>
    <script src="/static/js/app-logic-player.js"></script>
    <script src="/static/js/app-logic-ui.js"></script>
    
    <!-- Load main app.js file LAST -->
    <script src="/static/js/app.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="shortcut icon" href="/static/favicon/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/favicon/android-chrome-192x192.png">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .yt-icon:hover {
            color: #FF0000 !important;
        }
        .aspect-box {
            position: relative;
            width: 100%;
            background-color: var(--bg-highlight);
            transition: padding-top 0.3s ease-in-out;
        }
        .aspect-16-9 {
            padding-top: 56.25%;
        }
        .aspect-9-16 {
            padding-top: 177.78%;
        }
        /* Fix for Alpine's x-collapse */
        [x-collapse] {
            overflow: hidden;
            transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>

<body class="bg-[var(--bg-darkest)] text-[var(--text-main)]" x-data="videoApp" x-init="init()"
    :class="{ 'overflow-hidden': isMobileMenuOpen || isModalOpen || isPlaylistModalOpen || isSmartPlaylistModalOpen }"
    @save-smart-playlist-filters.window="saveSmartPlaylistSettings($event.detail)">
    
    <!-- Mobile Menu Overlay -->
    <div x-show="isMobileMenuOpen" @click="isMobileMenuOpen = false"
        x-transition:enter="transition-opacity ease-in-out duration-300" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="transition-opacity ease-in-out duration-300"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
        class="fixed inset-0 z-30 bg-black/60 lg:hidden" x-cloak></div>

    <div class="flex h-screen">

        <!-- Sidebar -->
        {% include 'partials/_sidebar.html' %}

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto lg:pl-72">
            
            <!-- Header -->
            {% include 'partials/_header.html' %}

            <!-- Video Grid -->
            <div class="grid grid-cols-1 gap-6 p-4" x-cloak :class="{
                    'sm:grid-cols-2 lg:grid-cols-3': currentView.type !== 'shorts',
                    'sm:grid-cols-3 lg:grid-cols-5': currentView.type === 'shorts'
                   }">
                <template x-if="filteredVideos.length === 0">
                    <p class="text-[var(--text-secondary)]" x-text="getEmptyMessage()"></p>
                </template>

                <!-- Video Card Template -->
                <template x-for="video in filteredVideos" :key="video.id">
                    {% include 'partials/_video_card.html' %}
                </template>
            </div>

            <!-- Load More Button / Loading Spinner -->
            <div class="pb-8 text-center"
                x-show="!isLoading && (currentPage <= totalPages) && currentView.type !== 'smart_playlist' && currentView.type !== 'standard_playlist'" x-cloak>
                <p class="mb-2 text-xs text-[var(--text-secondary)]">
                    Showing <span x-text="appData.videos.length"></span> of <span x-text="totalItems"></span> videos
                </p>
                <button @click="loadMoreVideos()"
                    class="rounded-md bg-[var(--bg-highlight)] px-5 py-2.5 text-sm font-medium text-[var(--text-bright)] hover:bg-[var(--bg-highlight-hover)] focus:outline-none focus:ring-2 focus:ring-[var(--highlight-ring)] focus:ring-opacity-50">
                    Load More (30)
                </button>
            </div>

            <div class="pb-8 text-center" x-show="isLoading" x-cloak>
                <span class="material-icons animate-spin text-[var(--text-highlight)]"
                    style="font-size: 40px;">sync</span>
            </div>
        </main>
    </div>

    <!-- Modals -->
    {% include 'partials/_video_modal.html' %}
    {% include 'partials/_playlist_modal.html' %}
    {% include 'partials/_smart_playlist_modal.html' %}

</body>
</html>