<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VolumePlay21</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,line-clamp,typography,aspect-ratio"></script>
    <script src="/static/js/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="shortcut icon" href="/static/favicon/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/favicon/android-chrome-192x192.png">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .yt-icon:hover {
            color: #FF0000 !important;
        }
        .aspect-box {
            position: relative;
            width: 100%;
            background-color: var(--bg-highlight);
            transition: padding-top 0.3s ease-in-out;
        }
        .aspect-16-9 {
            padding-top: 56.25%;
        }
        .aspect-9-16 {
            padding-top: 177.78%;
        }
    </style>
</head>

<body class="bg-[var(--bg-darkest)] text-[var(--text-main)]" x-data="videoApp" x-init="init()"
    :class="{ 'overflow-hidden': isMobileMenuOpen || isModalOpen }"
    @save-filter.window="saveFilterToPlaylist($event.detail.playlistId, $event.detail.filter)">
    <div x-show="isMobileMenuOpen" @click="isMobileMenuOpen = false"
        x-transition:enter="transition-opacity ease-in-out duration-300" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="transition-opacity ease-in-out duration-300"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
        class="fixed inset-0 z-30 bg-black/60 lg:hidden" x-cloak></div>

    <div class="flex h-screen">

        <aside
            class="fixed inset-y-0 left-0 z-40 flex w-72 transform flex-col border-r border-[var(--divider-color)] bg-[var(--bg-medium)] transition-transform duration-300 ease-in-out lg:translate-x-0"
            :class="{ '-translate-x-full': !isMobileMenuOpen, 'translate-x-0': isMobileMenuOpen }" x-cloak>

            <div class="flex h-16 shrink-0 items-center justify-between border-b border-[var(--divider-color)] px-4">
                <a href="#" @click.prevent="setView('all'); searchQuery=''" class="flex items-center gap-3 group">
                    <i class="material-icons" style="font-size:28px;color:#DD3D2D;">ondemand_video</i>
                    <span
                        class="text-lg font-semibold text-[var(--text-bright)] group-hover:text-[var(--text-main)]">VolumePlay21</span>
                </a>
                <div class="flex items-center gap-2">
                    <button type="button"
                        class="-mr-2 p-2 text-[var(--text-secondary)] hover:text-[var(--text-bright)] lg:hidden"
                        @click="isMobileMenuOpen = false">
                        <i class="material-icons" style="font-size: 24px;">close</i>
                    </button>
                </div>
            </div>

            <nav class="flex-1 space-y-1 overflow-y-auto px-4 pb-4 pt-4">
                <a href="#" @click.prevent="setView('all')"
                    class="flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors duration-300"
                    :class="currentView.type === 'all' ? 'main-nav-selected' : 'text-[var(--text-main)] hover:bg-[var(--bg-highlight)]/50 hover:text-[#5EEAD4]'"><i
                        class="material-icons" style="font-size:20px;">apps</i> All Videos</a>
                <a href="#" @click.prevent="setView('favorites')"
                    class="flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors duration-300"
                    :class="currentView.type === 'favorites' ? 'main-nav-selected' : 'text-[var(--text-main)] hover:bg-[var(--bg-highlight)]/50 hover:text-[#5EEAD4]'"><i
                        class="material-icons" style="font-size:20px;">star_outline</i> Favorites</a>
                <a href="#" @click.prevent="setView('watchLater')"
                    class="flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors duration-300"
                    :class="currentView.type === 'watchLater' ? 'main-nav-selected' : 'text-[var(--text-main)] hover:bg-[var(--bg-highlight)]/50 hover:text-[#5EEAD4]'"><i
                        class="material-icons" style="font-size:20px;">watch_later</i> Watch Later</a>
                <a href="#" @click.prevent="setView('history')"
                    class="flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors duration-300"
                    :class="currentView.type === 'history' ? 'main-nav-selected' : 'text-[var(--text-main)] hover:bg-[var(--bg-highlight)]/50 hover:text-[#5EEAD4]'"><i
                        class="material-icons" style="font-size:20px;">history</i> History</a>

                <hr class="border-[var(--divider-color)] mx-4 my-2">
                
                <div class="pt-2" x-cloak>
                    <h3 class="px-3 text-xs font-semibold uppercase text-[var(--text-secondary)]">Filter Tags</h3>
                    <div class="mt-1 flex flex-wrap gap-2 px-3 pb-3">

                        <button x-show="filterHistory.length > 0" @click.prevent="goBackOneFilter()"
                            class="inline-flex items-center justify-center h-7 w-7 rounded-full text-[var(--text-main)] hover:text-[var(--text-bright)] hover:bg-[var(--bg-highlight)]/50 transition-colors"
                            title="Go back one step (Filter History)">
                            <span class="material-icons" style="font-size: 20px;">arrow_back</span>
                        </button>

                        <a href="#" @click.prevent="filterByFolderTag('clear_all')"
                            x-show="currentView.type === 'folder' && currentView.id"
                            class="inline-block text-sm font-medium text-[var(--text-main)] hover:text-white px-2 py-0.5 rounded-full cursor-pointer transition-colors duration-150"
                            style="background-color: #6B7280;" title="Clear Folder Filter">
                            Clear All
                        </a>

                        <template x-for="tag in getDynamicTags" :key="tag">
                            <a href="#" @click.prevent="filterByFolderTag(tag)" @dragstart="startDrag(tag)"
                                draggable="true"
                                class="inline-block text-sm font-medium text-[var(--text-highlight)] bg-[#233b4b] hover:bg-[#165357] px-2 py-0.5 rounded-full cursor-pointer transition-colors duration-150"
                                x-text="tag" :title="'Filter by: ' + tag + ' (Drag to Playlist)'">
                            </a>
                        </template>
                        <template x-if="currentView.type !== 'all' && currentView.type !== 'folder'">
                            <p class="text-xs italic text-[var(--text-secondary)]">Tags only available for All
                                Videos/Folders.</p>
                        </template>
                        <template
                            x-if="getDynamicTags.length === 0 && (currentView.type === 'all' || currentView.type === 'folder')">
                            <p class="text-xs italic text-[var(--text-secondary)]">No deeper tags available.</p>
                        </template>
                    </div>
                </div>

                <div class="pt-2" x-data="{ newPlaylistName: '' }" x-cloak>
                    <div class="flex items-center justify-between px-3 mb-1">
                        <h3 class="text-xs font-semibold uppercase text-[var(--text-secondary)]">Smart Playlists</h3>
                    </div>

                    <div class="flex items-center gap-1 px-3 mb-2">
                        <input type="text" x-model="newPlaylistName"
                            @keydown.enter="createPlaylist(newPlaylistName); newPlaylistName=''"
                            placeholder="Enter playlist name..."
                            class="flex-1 w-full rounded-md border border-[var(--divider-color)] bg-[var(--bg-darkest)] text-sm text-[var(--text-bright)] placeholder-[var(--text-secondary)] focus:border-[var(--highlight-ring)] focus:ring-[var(--highlight-ring)] p-1.5">

                        <button @click="createPlaylist(newPlaylistName); newPlaylistName=''"
                            :disabled="newPlaylistName.trim() === ''"
                            class="p-1 text-[var(--text-secondary)] transition-colors"
                            :class="{ 'hover:text-[var(--text-bright)]': newPlaylistName.trim() !== '', 'opacity-50 cursor-not-allowed': newPlaylistName.trim() === '' }"
                            title="Create New Playlist">
                            <i class="material-icons" style="font-size: 20px;">add</i>
                        </button>
                    </div>

                    <div class="mt-1 space-y-1">
                        <template x-for="playlist in appData.smartPlaylists" :key="playlist.id">
                            <div x-data="{ showActions: false, hoverTimer: null, isEditingFilters: false }"
                                @mouseenter="clearTimeout(hoverTimer); hoverTimer = setTimeout(() => { showActions = true }, 1000)"
                                @mouseleave="clearTimeout(hoverTimer); showActions = false; isEditingFilters = false"
                                class="relative" @dragover.prevent @drop="handlePlaylistDrop(playlist.id, $event)">

                                <a href="#" @click.prevent="setView('smart_playlist', playlist.id)"
                                    class="flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors duration-100 hover:bg-[var(--bg-highlight)]/50 relative"
                                    :class="currentView.type === 'smart_playlist' && currentView.id === playlist.id ? 'main-nav-selected' : 'text-[var(--text-main)]'">

                                    <i class="material-icons" style="font-size:20px;">playlist_play</i>
                                    <span class="truncate flex-1" x-text="playlist.name"></span>
                                    <span
                                        class="text-xs text-[var(--text-secondary)]/70 transition-opacity duration-300"
                                        :class="{ 'opacity-0': showActions, 'invisible': showActions }"
                                        x-show="playlist.tags.length > 0 && !showActions">
                                        <span x-text="playlist.tags.length"></span>
                                    </span>

                                    <div class="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1 shrink-0 transition-opacity duration-300 pointer-events-none"
                                        :class="showActions ? 'opacity-100 pointer-events-auto' : 'opacity-0'">

                                        <button @click.stop.prevent="isEditingFilters = true; showActions = false"
                                            class="p-0.5 -m-0.5 text-[var(--text-secondary)] hover:text-cyan-400 transition-colors"
                                            title="Add Filter Criteria" :tabindex="showActions ? 0 : -1">
                                            <i class="material-icons" style="font-size: 18px;">filter_alt</i>
                                        </button>

                                        <button @click.stop.prevent="renamePlaylist(playlist)"
                                            class="p-0.5 -m-0.5 text-[var(--text-secondary)] hover:text-[var(--text-highlight)] transition-colors"
                                            title="Rename Playlist" :tabindex="showActions ? 0 : -1">
                                            <i class="material-icons" style="font-size: 18px;">edit</i>
                                        </button>
                                        <button @click.stop.prevent="deletePlaylist(playlist.id)"
                                            class="p-0.5 -m-0.5 text-red-500 hover:text-red-400 transition-colors"
                                            title="Delete Playlist" :tabindex="showActions ? 0 : -1">
                                            <i class="material-icons" style="font-size: 18px;">delete</i>
                                        </button>
                                    </div>
                                </a>

                                <div x-show="isEditingFilters" x-data="filterEditor(playlist.id, appData)"
                                    @click.outside="isEditingFilters = false"
                                    x-transition:enter="transition ease-out duration-150"
                                    x-transition:enter-start="opacity-0 translate-y-[-5px]"
                                    x-transition:enter-end="opacity-100 translate-y-0"
                                    x-transition:leave="transition ease-in duration-100"
                                    x-transition:leave-start="opacity-100 translate-y-0"
                                    x-transition:leave-end="opacity-0 translate-y-[-5px]"
                                    class="p-3 mt-1 space-y-3 border border-[var(--highlight-ring)]/50 rounded-md bg-[var(--bg-darkest)] shadow-xl"
                                    x-cloak>

                                    <div class="flex items-center justify-between">
                                        <h4 class="text-sm font-semibold text-[var(--text-highlight)]">Add Filter
                                        </h4>
                                        <button @click.stop="isEditingFilters = false"
                                            class="p-1 -m-1 text-[var(--text-secondary)] hover:text-red-500"
                                            title="Close">
                                            <i class="material-icons" style="font-size: 18px;">close</i>
                                        </button>
                                    </div>

                                    <div>
                                        <label class="block text-xs text-[var(--text-secondary)] mb-1">Filter
                                            Type</label>
                                        <select x-model="selectedType" @change="resetValues()"
                                            class="w-full rounded-md border-[var(--divider-color)] bg-[var(--bg-medium)] text-sm text-[var(--text-bright)] p-1.5 focus:border-[var(--highlight-ring)] focus:ring-[var(--highlight-ring)]">
                                            <option value="title">Title</option>
                                            <option value="author">Author / Channel</option>
                                        </select>
                                    </div>

                                    <template x-if="selectedType === 'title'">
                                        <div class="space-y-2">
                                            <div>
                                                <label class="block text-xs text-[var(--text-secondary)] mb-1">
                                                    Search Text (Use quotes for exact phrase match)
                                                </label>
                                                <input type="text" x-model="textValue"
                                                    @keydown.enter.prevent="applyFilter()"
                                                    class="w-full rounded-md border-[var(--divider-color)] bg-[var(--bg-medium)] text-sm text-[var(--text-bright)] p-1.5"
                                                    placeholder="e.g. 'time' or 'space exploration'">
                                            </div>
                                        </div>
                                    </template>

                                    <template x-if="selectedType === 'author'">
                                        <div class="space-y-2">
                                            <div>
                                                <label class="block text-xs text-[var(--text-secondary)] mb-1">
                                                    Select Authors (Hold Ctrl/Cmd to select multiple)
                                                </label>
                                                <select multiple x-model="selectedAuthors"
                                                    class="w-full h-32 rounded-md border-[var(--divider-color)] bg-[var(--bg-medium)] text-sm text-[var(--text-bright)] p-1.5 focus:border-[var(--highlight-ring)] focus:ring-[var(--highlight-ring)]">
                                                    <template x-for="author in allAuthors" :key="author">
                                                        <option :value="author" x-text="author"></option>
                                                    </template>
                                                </select>
                                            </div>
                                        </div>
                                    </template>

                                    <button @click="applyFilter()" :disabled="!isFilterValid()"
                                        class="w-full rounded-md bg-[var(--text-highlight)] disabled:bg-opacity-50 px-3 py-1.5 text-sm font-medium text-[var(--bg-darkest)] hover:bg-opacity-80 transition-colors">
                                        Apply Filter
                                    </button>
                                </div>

                                <template
                                    x-if="currentView.type === 'smart_playlist' && currentView.id === playlist.id && playlist.filters && playlist.filters.length > 0">
                                    <div
                                        class="flex flex-wrap gap-1.5 px-3 py-2 border-t border-[var(--divider-color)] bg-[var(--bg-darkest)]">
                                        <span
                                            class="text-xs font-semibold uppercase text-[var(--text-secondary)] mr-1 self-center">Filters:</span>

                                        <template x-for="filter in playlist.filters" :key="filter.id">
                                            <span
                                                class="inline-flex items-center gap-1.5 text-xs font-medium text-cyan-200 px-2 py-0.5 rounded-full"
                                                style="background-color: #233b4b;">
                                                <span>
                                                    <span class="font-semibold" x-text="filter.label + ': '"></span>
                                                    <template x-if="typeof filter.value === 'string'">
                                                        <span class="italic"
                                                            x-text="'&quot;' + filter.value + '&quot;'"></span>
                                                    </template>
                                                    <template x-if="Array.isArray(filter.value)">
                                                        <span class="italic" x-text="filter.value.join(', ')"></span>
                                                    </template>
                                                </span>
                                                <button
                                                    @click.prevent="removeFilterFromPlaylist(playlist.id, filter.id)"
                                                    class="p-0.5 -m-0.5 text-cyan-400 hover:text-red-500 rounded-full transition-colors">
                                                    <i class="material-icons" style="font-size: 14px;">close</i>
                                                </button>
                                            </span>
                                        </template>
                                    </div>
                                </template>

                                <template
                                    x-if="currentView.type === 'smart_playlist' && currentView.id === playlist.id && playlist.tags.length > 0">
                                    <div
                                        class="flex flex-wrap gap-1 px-3 py-2 border-t border-[var(--divider-color)] bg-[var(--bg-darkest)]">
                                        <span
                                            class="text-xs font-semibold uppercase text-[var(--text-secondary)] mr-1">Tags:</span>
                                        <template x-for="tag in playlist.tags" :key="tag">
                                            <a href="#" @click.prevent="removeTagFromPlaylist(playlist.id, tag)"
                                                class="inline-block text-xs font-medium text-white px-1.5 py-0.5 rounded-full cursor-pointer transition-colors duration-150 group-hover:bg-red-500/50"
                                                style="background-color: #233b4b;" x-text="tag"
                                                title="Click to remove tag from playlist">
                                            </a>
                                        </template>
                                    </div>
                                </template>
                            </div>
                        </template>
                        <p x-show="appData.smartPlaylists.length === 0"
                            class="px-3 text-xs italic text-[var(--text-secondary)]">Start by entering a name above.</p>
                    </div>
                </div>

                <hr class="border-[var(--divider-color)] mx-4 my-2">

                <div class="pt-2 px-4 pb-2 space-y-2" x-cloak>
                    <h3 class="text-xs font-semibold uppercase text-[var(--text-secondary)] mb-2">Global Filters</h3>

                    <button @click="cycleShortsFilter()"
                        class="flex w-full items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                        <i class="material-icons transition-colors" style="font-size: 20px;" :class="{
                                'text-[var(--text-highlight)]': filterSettings.shorts === 'solo',
                                'text-red-500': filterSettings.shorts === 'hide'
                           }">ondemand_video</i>
                        <span>Shorts</span>
                    </button>

                    <button @click="cycleVRFilter()"
                        class="flex w-full items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                        <i class="material-icons transition-colors" style="font-size: 20px;" :class="{
                                'text-[var(--text-highlight)]': filterSettings.vr === 'solo',
                                'text-red-500': filterSettings.vr === 'hide'
                           }">view_in_ar</i>
                        <span>3D / VR</span>
                    </button>

                    <button @click="cycleOptimizedFilter()"
                        class="flex w-full items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                        <i class="material-icons transition-colors" style="font-size: 20px;" :class="{
                                'text-[var(--text-highlight)]': filterSettings.optimized === 'solo',
                                'text-red-500': filterSettings.optimized === 'hide'
                           }">movie_filter</i>
                        <span>Optimized</span>
                    </button>
                </div>

                <hr class="border-[var(--divider-color)] mx-4 my-2">
                
                <div class="pt-2 px-4 pb-4 space-y-2" x-cloak>
                    <h3 class="text-xs font-semibold uppercase text-[var(--text-secondary)] mb-2">Library Tools</h3>
                    
                    <button @click="scanNewVideos()" :disabled="isAnyTaskRunning()"
                        class="w-full flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium transition-colors duration-300 bg-[var(--bg-darkest)] text-[var(--text-highlight)] hover:bg-[var(--divider-color)] disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="material-icons" style="font-size:20px;" :class="{ 'animate-spin': scanType === 'new' }">video_file</i>
                        <span x-text="scanType === 'new' ? 'Scanning New...' : 'Scan New Videos'"></span>
                    </button>

                    <button @click="generateMissingThumbnails()" :disabled="isAnyTaskRunning()"
                        class="w-full flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium transition-colors duration-300 bg-[var(--bg-darkest)] text-[var(--text-highlight)] hover:bg-[var(--divider-color)] disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="material-icons" style="font-size:20px;" :class="{ 'animate-spin': isGeneratingThumbnails }">image</i>
                        <span x-text="isGeneratingThumbnails ? libraryTaskButtonText : 'Gen. Missing Thumbs'"></span>
                    </button>

                    <button @click="cleanupLibrary()" :disabled="isAnyTaskRunning()"
                        class="w-full flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium transition-colors duration-300 bg-[var(--bg-darkest)] text-[var(--text-highlight)] hover:bg-[var(--divider-color)] disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="material-icons" style="font-size:20px;" :class="{ 'animate-spin': isCleaningUp }">delete_sweep</i>
                        <span x-text="isCleaningUp ? 'Pruning...' : 'Prune Library'"></span>
                    </button>
                    
                    <button @click="scanFullLibrary()" :disabled="isAnyTaskRunning()"
                        class="w-full flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium transition-colors duration-300 bg-[var(--bg-darkest)] text-[var(--text-highlight)] hover:bg-[var(--divider-color)] disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="material-icons" style="font-size:20px;" :class="{ 'animate-spin': scanType === 'full' }">manage_search</i>
                        <span x-text="scanType === 'full' ? 'Scanning All...' : 'Scan Entire Library'"></span>
                    </button>
                </div>
            </nav>
        </aside>

        <main class="flex-1 overflow-y-auto lg:pl-72">
            <header
                class="sticky top-0 z-10 flex h-16 shrink-0 items-center justify-between border-b border-[var(--divider-color)] bg-[var(--bg-darkest)]/80 px-4 backdrop-blur-sm sm:px-6 lg:px-8">
                <button type="button"
                    class="-ml-2.5 p-2.5 text-[var(--text-secondary)] hover:text-[var(--text-bright)] lg:hidden"
                    @click="isMobileMenuOpen = true">
                    <i class="material-icons" style="font-size: 24px;">menu</i>
                </button>
                <div class="hidden min-w-0 flex-1 items-center gap-2 lg:flex">
                    <button
                        x-show="currentView.type === 'author' || currentView.type === 'folder' || currentView.type === 'custom_stream' || currentView.type === 'category'"
                        @click="setView('all'); searchQuery=''"
                        class="p-1 text-[var(--text-secondary)] hover:text-[var(--text-bright)] transition-colors"
                        title="Clear all filters" x-transition:enter="transition ease-out duration-100"
                        x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
                        x-transition:leave="transition ease-in duration-75"
                        x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
                        x-cloak>
                        <span class="material-icons" style="font-size: 24px;">cancel</span>
                    </button>

                    <button x-show="filterHistory.length > 0" @click="goBackOneFilter()"
                        class="p-1 text-[var(--text-secondary)] hover:text-[var(--text-bright)] transition-colors"
                        title="Go back one filter step" x-transition:enter="transition ease-out duration-100"
                        x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
                        x-transition:leave="transition ease-in duration-75"
                        x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
                        x-cloak>
                        <span class="material-icons" style="font-size: 24px;">arrow_back</span>
                    </button>

                    <div class="min-w-0 flex-1 flex items-center">
                        <h1 class="truncate text-xl font-semibold text-[var(--text-bright)]" x-text="currentTitle"></h1>
                    </div>
                </div>
                <div class="flex shrink-0 items-center gap-2 pl-2 sm:pl-4">
                    <div class="flex items-center gap-1.5" title="Toggle Autoplay">
                        <span class="material-icons text-sm"
                            :class="isAutoplayEnabled ? 'text-[var(--text-highlight)]' : 'text-[var(--text-secondary)]'">
                            autoplay
                        </span>
                        <button @click="isAutoplayEnabled = !isAutoplayEnabled"
                            class="relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-[var(--highlight-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-medium)]"
                            :class="isAutoplayEnabled ? 'bg-[var(--text-highlight)]' : 'bg-[var(--divider-color)]'"
                            role="switch" :aria-checked="isAutoplayEnabled.toString()">
                            <span
                                class="pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                                :class="{ 'translate-x-4': isAutoplayEnabled, 'translate-x-0': !isAutoplayEnabled }"></span>
                        </button>
                    </div>
                    <div class="relative">
                        <span class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="material-icons text-[var(--text-secondary)]" style="font-size: 20px;">search</i>
                        </span>
                        <input type="search" placeholder="Search..." x-model.debounce.300ms="searchQuery"
                            class="w-32 rounded-md border-[var(--divider-color)] bg-[var(--bg-medium)] pl-10 text-sm text-[var(--text-bright)] placeholder-[var(--text-secondary)] focus:border-[var(--highlight-ring)] focus:ring-[var(--highlight-ring)] sm:w-52">
                    </div>
                    <select x-model="sortOrder"
                        class="hidden rounded-md border-[var(--divider-color)] bg-[var(--bg-medium)] text-sm text-[var(--text-bright)] focus:border-[var(--highlight-ring)] focus:ring-[var(--highlight-ring)] sm:block">
                        <option value="aired_newest">Aired (Newest)</option>
                        <option value="aired_oldest">Aired (Oldest)</option>
                        <option value="uploaded_newest">Upload (Newest)</option>
                        <option value="uploaded_oldest">Upload (Oldest)</option>
                    </select>
                    <button class="p-2 text-[var(--text-secondary)] hover:text-[var(--text-bright)]"
                        @click="scanNewVideos()" :disabled="isAnyTaskRunning()">
                        <i class="material-icons" :class="{ 'animate-spin': isAnyTaskRunning() }"
                            style="font-size: 20px;">refresh</i>
                    </button>
                </div>
            </header>

            <div class="grid grid-cols-1 gap-6 p-4" x-cloak :class="{
                    'sm:grid-cols-2 lg:grid-cols-3': currentView.type !== 'shorts',
                    'sm:grid-cols-3 lg:grid-cols-5': currentView.type === 'shorts'
                   }">
                <template x-if="filteredVideos.length === 0">
                    <p class="text-[var(--text-secondary)]" x-text="getEmptyMessage()"></p>
                </template>

                <template x-for="video in filteredVideos" :key="video.id">
                    <div class="flex flex-col overflow-hidden rounded-lg bg-[var(--bg-medium)] shadow-lg">

                        <a href="#" @click.prevent="openModal(video)">
                            <template x-if="video.image_url">
                                <div class="aspect-box"
                                    :class="{ 'aspect-16-9': currentView.type !== 'shorts', 'aspect-9-16': currentView.type === 'shorts' }">

                                    <img class="absolute top-0 left-0 w-full h-full object-cover blur-lg scale-110 brightness-75"
                                        :src="video.image_url" alt="" @error="$event.target.style.display='none'">

                                    <img class="absolute top-0 left-0 w-full h-full" :class="{
                                            'object-contain': currentView.type !== 'shorts',
                                            'object-cover': currentView.type === 'shorts'
                                       }" :src="video.image_url" alt=""
                                        @error="$event.target.style.display='none'; $event.target.nextElementSibling.style.display='flex'">

                                    <div
                                        class="no-thumb-text hidden absolute top-0 left-0 w-full h-full items-center justify-center text-[var(--text-secondary)]">
                                        (Image failed)</div>

                                    <div x-show="video.duration > 0"
                                        class="absolute top-2 right-2 rounded-sm bg-black/70 px-1.5 py-0.5 text-xs font-semibold text-white">
                                        <span x-text="formatDuration(video.duration)"></span>
                                    </div>
                                </div>
                            </template>
                            <template x-if="!video.image_url">
                                <div class="aspect-box"
                                    :class="{ 'aspect-16-9': currentView.type !== 'shorts', 'aspect-9-16': currentView.type === 'shorts' }">
                                    <div
                                        class="absolute top-0 left-0 w-full h-full flex items-center justify-center text-[var(--text-secondary)]">
                                        (No Thumbnail)</div>
                                </div>
                            </template>
                        </a>

                        <div class="flex flex-1 flex-col justify-between p-5">
                            <div class="flex-1">
                                <h3 class="text-md font-semibold text-[var(--text-bright)] leading-tight"
                                    style="text-wrap: balance;">
                                    <a href="#" @click.prevent="openModal(video)" class="hover:underline"
                                        x-text="video.title"></a>
                                </h3>
                            </div>
                        </div>

                        <div
                            class="flex items-center justify-between gap-2 border-t border-[var(--divider-color)] p-3 px-5 bg-[#182030]">

                            <div class="min-w-0 flex-1 text-sm text-[var(--text-secondary)]">

                                <div class="flex items-center">
                                    <a href="#" @click.prevent="setView('author', null, video.author)"
                                        class="inline-block font-medium text-[var(--text-highlight)] px-2 py-0.5 rounded-full bg-[#233b4b] hover:bg-[#165357] transition-colors truncate flex-shrink"
                                        x-text="video.author"></a>

                                    <template x-if="video.is_short">
                                        <a href="#"
                                            @click.prevent.stop="currentView.type === 'shorts' ? setView('all') : setView('shorts')"
                                            class="inline-block text-xs font-medium px-2 py-0.5 rounded-full ml-1.5 transition-colors flex-shrink-0"
                                            style="color: #FEDA8B; background-color: transparent; border: 1px solid #e16c39;"
                                            onmouseover="this.style.borderColor='#fff8e8'"
                                            onmouseout="this.style.borderColor='#e16c39'"
                                            :title="currentView.type === 'shorts' ? 'Clear Shorts filter' : 'Filter by Shorts'">
                                            Short
                                        </a>
                                    </template>
                                    <template x-if="video.has_transcode">
                                        <a href="#"
                                            @click.prevent.stop="currentView.type === 'optimized' ? setView('all') : setView('optimized')"
                                            class="inline-block text-xs font-medium px-2 py-0.5 rounded-full ml-1.5 transition-colors flex-shrink-0"
                                            style="color: #93c5fd; background-color: transparent; border: 1px solid #1e40af;"
                                            onmouseover="this.style.borderColor='#dbeafe'"
                                            onmouseout="this.style.borderColor='#1e40af'"
                                            :title="currentView.type === 'optimized' ? 'Clear Optimized filter' : 'Filter by Optimized'">
                                            Optimized
                                        </a>
                                    </template>

                                    <template
                                        x-if="video.video_type === 'VR180_SBS' || video.video_type === 'VR180_TB'">
                                        <a href="#"
                                            @click.prevent.stop="currentView.type === 'VR180' ? setView('all') : setView('VR180')"
                                            class="inline-block text-xs font-medium px-2 py-0.5 rounded-full ml-1.5 transition-colors flex-shrink-0"
                                            style="color: #f0abfc; background-color: transparent; border: 1px solid #701a75;"
                                            onmouseover="this.style.borderColor='#f5d0fe'"
                                            onmouseout="this.style.borderColor='#701a75'"
                                            :title="currentView.type === 'VR180' ? 'Clear VR180 filter' : 'Filter by VR180'">
                                            VR180
                                        </a>
                                    </template>
                                    <template x-if="video.video_type === 'VR360'">
                                        <a href="#"
                                            @click.prevent.stop="currentView.type === 'VR360' ? setView('all') : setView('VR360')"
                                            class="inline-block text-xs font-medium px-2 py-0.5 rounded-full ml-1.5 transition-colors flex-shrink-0"
                                            style="color: #f0abfc; background-color: transparent; border: 1px solid #701a75;"
                                            onmouseover="this.style.borderColor='#f5d0fe'"
                                            onmouseout="this.style.borderColor='#701a75'"
                                            :title="currentView.type === 'VR360' ? 'Clear VR360 filter' : 'Filter by VR360'">
                                            VR360
                                        </a>
                                    </template>
                                </div>

                                <span class="block truncate text-xs mt-1 ml-2"
                                    x-text="formatDateAgo(video.published, video.uploaded)"></span>
                            </div>

                            <div class="flex shrink-0 items-center gap-0">
                                <button class="p-1" @click.prevent="toggleFavorite(video)"
                                    :class="video.is_favorite ? 'text-[var(--text-highlight)]' : 'text-[var(--text-secondary)] hover:text-[var(--text-highlight)]'"><i
                                        class="material-icons" style="font-size: 20px;"
                                        x-text="video.is_favorite ? 'star' : 'star_border'"></i></button>
                                <button class="p-1" @click.prevent="toggleBookmark(video)"
                                    :class="video.is_read_later ? 'text-[var(--text-highlight)]' : 'text-[var(--text-secondary)] hover:text-[var(--text-highlight)]'"><i
                                        class="material-icons" style="font-size: 20px;"
                                        x-text="video.is_read_later ? 'watch_later' : 'schedule'"></i></button>
                            </div>

                        </div>
                    </div>
                </template>
            </div>

            <div class="pb-8 text-center"
                x-show="!isLoading && (currentPage <= totalPages) && currentView.type !== 'smart_playlist'" x-cloak>
                <p class="mb-2 text-xs text-[var(--text-secondary)]">
                    Showing <span x-text="appData.videos.length"></span> of <span x-text="totalItems"></span> videos
                </p>
                <button @click="loadMoreVideos()"
                    class="rounded-md bg-[var(--bg-highlight)] px-5 py-2.5 text-sm font-medium text-[var(--text-bright)] hover:bg-[var(--bg-highlight-hover)] focus:outline-none focus:ring-2 focus:ring-[var(--highlight-ring)] focus:ring-opacity-50">
                    Load More (50)
                </button>
            </div>

            <div class="pb-8 text-center" x-show="isLoading" x-cloak>
                <span class="material-icons animate-spin text-[var(--text-highlight)]"
                    style="font-size: 40px;">sync</span>
            </div>
        </main>
    </div>

    <div x-show="isModalOpen" @keydown.escape.window="closeModal()"
        class="fixed inset-0 z-50 flex items-start justify-center overflow-y-auto bg-black/80 p-4 pt-12 sm:p-8" x-cloak>
        <div class="fixed inset-0" @click="closeModal()" x-transition:enter="ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"></div>

        <div class="relative z-10 w-full max-w-5xl overflow-hidden rounded-lg bg-[#111827] shadow-xl"
            x-show="isModalOpen" x-transition:enter="ease-out duration-300"
            x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
            x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" x-transition:leave="ease-in duration-200"
            x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
            x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">

            <button
                class="absolute top-2 right-2 z-20 p-1 text-[var(--text-secondary)] hover:text-[var(--text-bright)] transition-colors"
                @click="closeModal()" title="Close Player">
                <i class="material-icons" style="font-size: 24px;">cancel</i>
            </button>

            <template x-if="modalVideo">
                <div>
                    <div class="relative">
                        <div class="p-0 bg-black relative z-10">
                            <video x-if="modalVideo" id="main-video-player"
                                class="w-full max-h-[80vh] h-auto relative z-10" :src="currentVideoSrc" controls
                                autoplay @ended="handleVideoEnd()" x-ref="videoPlayer" crossorigin="anonymous"
                                @enterpictureinpicture="handleEnterPiP()" @leavepictureinpicture="handleLeavePiP()">

                                <template x-if="modalVideo.subtitle_url">
                                    <track :label="modalVideo.subtitle_label" kind="subtitles"
                                        :src="modalVideo.subtitle_url" :srclang="modalVideo.subtitle_lang">
                                </template>
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        <div
                            class="absolute bottom-0 left-[10%] w-[80%] h-8 bg-white blur-3xl opacity-40 transform translate-y-1/2">
                        </div>
                    </div>

                    <div class="p-4 sm:p-5">
                        <div class="lg:flex lg:gap-x-8">
                            <div class="lg:w-2/3">

                                <div class="flex items-center gap-3">
                                    <template x-if="modalVideo.show_poster_url">
                                        <img :src="modalVideo.show_poster_url" alt="Show Poster"
                                            class="w-12 h-12 object-cover rounded-lg flex-shrink-0">
                                    </template>
                                    <div>
                                        <a href="#" @click.prevent="navigateToAuthorFilter(modalVideo.author)"
                                            class="text-sm font-bold text-[var(--text-highlight)] hover:underline"
                                            x-text="modalVideo.author || 'Unknown Author'">
                                        </a>
                                        <span class="block text-sm text-[var(--text-secondary)]"
                                            x-text="getAuthorVideoCount(modalVideo.author)">
                                        </span>
                                    </div>
                                </div>

                                <div class="mt-4 border-t border-[var(--divider-color)] pt-4">
                                    <h2 class="text-2xl font-bold text-[var(--text-bright)] tracking-tight leading-tight"
                                        style="text-wrap: balance;" x-text="modalVideo.title">
                                    </h2>
                                </div>

                                <div class="mt-2 text-xs text-[var(--text-secondary)]"
                                    x-text="formatDateAgo(modalVideo.published, modalVideo.uploaded)">
                                </div>

                                <div class="lg:hidden mt-4">
                                    <div class="grid grid-cols-6 gap-2 mb-2">
                                        <button @click.prevent="playPreviousVideo()" title="Previous Video"
                                            class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;">skip_previous</i>
                                        </button>
                                        <button @click.prevent="previousFrame()" title="Previous Frame"
                                            class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;">chevron_left</i>
                                        </button>
                                        <button @click.prevent="$refs.videoPlayer.currentTime -= 5" title="Seek Back 5s"
                                            class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;">fast_rewind</i>
                                        </button>
                                        <button @click.prevent="$refs.videoPlayer.currentTime += 10"
                                            title="Seek Forward 10s"
                                            class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;">fast_forward</i>
                                        </button>
                                        <button @click.prevent="nextFrame()" title="Next Frame"
                                            class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;">chevron_right</i>
                                        </button>
                                        <button @click.prevent="playNextVideo()" title="Next Video"
                                            class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;">skip_next</i>
                                        </button>
                                    </div>

                                    <div class="grid grid-cols-4 gap-2 mb-2">
                                        <button
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                            @click.prevent="toggleBookmark(modalVideo)" title="Watch Later">
                                            <i class="material-icons" style="font-size: 20px;"
                                                x-text="modalVideo.is_read_later ? 'watch_later' : 'schedule'"></i>
                                        </button>
                                        <button
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                            @click.prevent="toggleFavorite(modalVideo)" title="Favorite">
                                            <i class="material-icons" style="font-size: 20px;"
                                                x-text="modalVideo.is_favorite ? 'star' : 'star_border'"></i>
                                        </button>
                                        <a :href="modalVideo.video_url" :download="modalVideo.filename"
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                            title="Download original file">
                                            <i class="material-icons" style="font-size: 20px;">download</i>
                                        </a>
                                        <button
                                            @click.prevent="document.getElementById('more-info-panel').scrollIntoView({ behavior: 'smooth' })"
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                            title="Scroll to file details">
                                            <i class="material-icons" style="font-size: 20px;">info</i>
                                        </button>
                                    </div>

                                    <div class="grid grid-cols-2 gap-2">
                                        <button
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                            @click.prevent="cyclePlaybackSpeed()" title="Change Playback Speed">
                                            <i class="material-icons" style="font-size: 20px;">speed</i>
                                            <span x-text="currentPlaybackSpeed.toFixed(2) + 'x'"></span>
                                        </button>

                                        <template x-if="!modalVideo.has_custom_thumb && !isCreatingThumb">
                                            <button @click.prevent="createCustomThumb()"
                                                class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                                <i class="material-icons"
                                                    style="font-size: 20px;">add_photo_alternate</i>
                                                <span>Create Thumb</span>
                                            </button>
                                        </template>
                                        <template x-if="modalVideo.has_custom_thumb && !isCreatingThumb">
                                            <button @click.prevent="deleteCustomThumb()"
                                                class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                                <i class="material-icons" style="font-size: 20px;">delete_outline</i>
                                                <span>Remove Thumb</span>
                                            </button>
                                        </template>
                                        <template x-if="isCreatingThumb">
                                            <button disabled
                                                class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] text-[#9CA3AF] opacity-70">
                                                <i class="material-icons animate-spin" style="font-size: 20px;">sync</i>
                                                <span>Working...</span>
                                            </button>
                                        </template>

                                        <template x-if="!modalVideo.has_transcode && !isTranscoding">
                                            <button @click.prevent="startTranscode(modalVideo)"
                                                class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                                <i class="material-icons" style="font-size: 20px;">movie_filter</i>
                                                <span>Optimize</span>
                                            </button>
                                        </template>
                                        <template x-if="isTranscoding && modalVideo.id === transcodeStatus.video_id">
                                            <button disabled
                                                class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] text-[#9CA3AF] opacity-70">
                                                <i class="material-icons animate-spin" style="font-size: 20px;">sync</i>
                                                <span>Optimizing...</span>
                                            </button>
                                        </template>
                                        <template x-if="modalVideo.has_transcode && !isTranscoding">
                                            <button @click.prevent="deleteTranscode(modalVideo)"
                                                class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                                <i class="material-icons" style="font-size: 20px;">delete_outline</i>
                                                <span>Remove Optimized</span>
                                            </button>
                                        </template>
                                        <template x-if="modalVideo.has_transcode">
                                            <a :href="modalVideo.transcode_download_url"
                                                class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                                title="Download optimized MP4">
                                                <i class="material-icons"
                                                    style="font-size: 20px;">download_for_offline</i>
                                                <span>Optimized</span>
                                            </a>
                                        </template>

                                        <template x-if="modalVideo.youtube_id">
                                            <a :href="'https://www.youtube.com/watch?v=' + modalVideo.youtube_id"
                                                target="_blank"
                                                class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF] yt-icon"
                                                title="Watch on YouTube">
                                                <i class="material-icons" style="font-size: 20px;">smart_display</i>
                                                <span>YouTube</span>
                                            </a>
                                        </template>

                                        <button @click.prevent="cycleVideoTag(modalVideo)"
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;"
                                                x-text="getVideoTagIcon(modalVideo)"></i>
                                            <span x-text="getVideoTagText(modalVideo)" class="truncate min-w-0"></span>
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-4 bg-[#0b101a] rounded-2xl p-5">
                                    <div class="prose prose-sm prose-invert max-w-none text-[var(--text-main)] prose-p:font-sm"
                                        style="overflow-wrap: break-word;"
                                        x-html="formatVideoDescription(modalVideo.summary || 'No summary available.')">
                                    </div>
                                </div>

                                <div id="more-info-panel"
                                    class="mt-4 border-t border-[var(--divider-color)] pt-4 text-[var(--text-main)]"
                                    x-cloak>
                                    <div class="prose prose-sm prose-invert max-w-none space-y-3">
                                        <div>
                                            <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Filename</h4>
                                            <p class="!mt-0.5 break-words" x-text="modalVideo.filename"></p>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Path</h4>
                                            <p class="!mt-0.5 break-words" x-text="modalVideo.relative_path"></p>
                                        </div>
                                        <div class="grid grid-cols-5 gap-x-4">
                                            <div>
                                                <h4 class="font-semibold text-[var(--text-secondary)] !m-0">File Size
                                                </h4>
                                                <p class="!mt-0.5" x-text="formatFileSize(modalVideo.file_size)"></p>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Format</h4>
                                                <p class="!mt-0.5" x-text="modalVideo.file_format"></p>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Dimensions
                                                </h4>
                                                <p class="!mt-0.5" x-text="modalVideo.dimensions || 'Unknown'"></p>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Length</h4>
                                                <p class="!mt-0.5"
                                                    x-text="formatDuration(modalVideo.duration) || 'N/A'"></p>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Codec</h4>
                                                <p class="!mt-0.5" x-text="modalVideo.video_codec || 'N/A'"></p>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-[var(--text-secondary)] !m-0">Associated Files
                                            </h4>
                                            <div class="!mt-0.5 flex flex-wrap gap-x-3 gap-y-1">
                                                <span class="inline-flex items-center gap-1">
                                                    <i class="material-icons text-[var(--text-highlight)]"
                                                        style="font-size: 16px;">videocam</i>
                                                    <span x-text="modalVideo.file_format"></span>
                                                </span>
                                                <template x-if="modalVideo.has_subtitle">
                                                    <span class="inline-flex items-center gap-1">
                                                        <i class="material-icons text-[var(--text-highlight)]"
                                                            style="font-size: 16px;">subtitles</i>
                                                        <span>SRT</span>
                                                    </span>
                                                </template>
                                                <template x-if="modalVideo.has_thumbnail">
                                                    <span class="inline-flex items-center gap-1">
                                                        <i class="material-icons text-[var(--text-highlight)]"
                                                            style="font-size: 16px;">image</i>
                                                        <span>JPG</span>
                                                    </span>
                                                </template>
                                                <template x-if="modalVideo.has_nfo">
                                                    <span class="inline-flex items-center gap-1">
                                                        <i class="material-icons text-[var(--text-highlight)]"
                                                            style="font-size: 16px;">description</i>
                                                        <span>NFO</span>
                                                    </span>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="hidden lg:block lg:w-1/3 lg:mt-0">
                                <div class="grid grid-cols-6 gap-2 mb-2">
                                    <button @click.prevent="playPreviousVideo()" title="Previous Video"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">skip_previous</i>
                                    </button>
                                    <button @click.prevent="previousFrame()" title="Previous Frame"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">chevron_left</i>
                                    </button>
                                    <button @click.prevent="$refs.videoPlayer.currentTime -= 5" title="Seek Back 5s"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">fast_rewind</i>
                                    </button>
                                    <button @click.prevent="$refs.videoPlayer.currentTime += 10"
                                        title="Seek Forward 10s"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">fast_forward</i>
                                    </button>
                                    <button @click.prevent="nextFrame()" title="Next Frame"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">chevron_right</i>
                                    </button>
                                    <button @click.prevent="playNextVideo()" title="Next Video"
                                        class="flex items-center justify-center p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;">skip_next</i>
                                    </button>
                                </div>

                                <div class="grid grid-cols-4 gap-2 mb-2">
                                    <button
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                        @click.prevent="toggleBookmark(modalVideo)" title="Watch Later">
                                        <i class="material-icons" style="font-size: 20px;"
                                            x-text="modalVideo.is_read_later ? 'watch_later' : 'schedule'"></i>
                                    </button>
                                    <button
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                        @click.prevent="toggleFavorite(modalVideo)" title="Favorite">
                                        <i class="material-icons" style="font-size: 20px;"
                                            x-text="modalVideo.is_favorite ? 'star' : 'star_border'"></i>
                                    </button>
                                    <a :href="modalVideo.video_url" :download="modalVideo.filename"
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                        title="Download original file">
                                        <i class="material-icons" style="font-size: 20px;">download</i>
                                    </a>
                                    <button
                                        @click.prevent="document.getElementById('more-info-panel').scrollIntoView({ behavior: 'smooth' })"
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                        title="Scroll to file details">
                                        <i class="material-icons" style="font-size: 20px;">info</i>
                                    </button>
                                </div>

                                <div class="grid grid-cols-2 gap-2">
                                    <button
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                        @click.prevent="cyclePlaybackSpeed()" title="Change Playback Speed">
                                        <i class="material-icons" style="font-size: 20px;">speed</i>
                                        <span x-text="currentPlaybackSpeed.toFixed(2) + 'x'"></span>
                                    </button>

                                    <template x-if="!modalVideo.has_custom_thumb && !isCreatingThumb">
                                        <button @click.prevent="createCustomThumb()"
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;">add_photo_alternate</i>
                                            <span>Create Thumb</span>
                                        </button>
                                    </template>
                                    <template x-if="modalVideo.has_custom_thumb && !isCreatingThumb">
                                        <button @click.prevent="deleteCustomThumb()"
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;">delete_outline</i>
                                            <span>Remove Thumb</span>
                                        </button>
                                    </template>
                                    <template x-if="isCreatingThumb">
                                        <button disabled
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] text-[#9CA3AF] opacity-70">
                                            <i class="material-icons animate-spin" style="font-size: 20px;">sync</i>
                                            <span>Working...</span>
                                        </button>
                                    </template>

                                    <template x-if="!modalVideo.has_transcode && !isTranscoding">
                                        <button @click.prevent="startTranscode(modalVideo)"
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;">movie_filter</i>
                                            <span>Optimize</span>
                                        </button>
                                    </template>
                                    <template x-if="isTranscoding && modalVideo.id === transcodeStatus.video_id">
                                        <button disabled
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] text-[#9CA3AF] opacity-70">
                                            <i class="material-icons animate-spin" style="font-size: 20px;">sync</i>
                                            <span>Optimizing...</span>
                                        </button>
                                    </template>
                                    <template x-if="modalVideo.has_transcode && !isTranscoding">
                                        <button @click.prevent="deleteTranscode(modalVideo)"
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                            <i class="material-icons" style="font-size: 20px;">delete_outline</i>
                                            <span>Remove Optimized</span>
                                        </button>
                                    </template>
                                    <template x-if="modalVideo.has_transcode">
                                        <a :href="modalVideo.transcode_download_url"
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]"
                                            title="Download optimized MP4">
                                            <i class="material-icons" style="font-size: 20px;">download_for_offline</i>
                                            <span>Optimized</span>
                                        </a>
                                    </template>

                                    <template x-if="modalVideo.youtube_id">
                                        <a :href="'https://www.youtube.com/watch?v=' + modalVideo.youtube_id"
                                            target="_blank"
                                            class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF] yt-icon"
                                            title="Watch on YouTube">
                                            <i class="material-icons" style="font-size: 20px;">smart_display</i>
                                            <span>YouTube</span>
                                        </a>
                                    </template>

                                    <button @click.prevent="cycleVideoTag(modalVideo)"
                                        class="flex items-center justify-center gap-2 p-2.5 rounded-md transition-colors text-sm bg-[#29334b] hover:bg-[#43547c] text-[#9CA3AF] hover:text-[#FFFFFF]">
                                        <i class="material-icons" style="font-size: 20px;"
                                            x-text="getVideoTagIcon(modalVideo)"></i>
                                        <span x-text="getVideoTagText(modalVideo)" class="truncate min-w-0"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
</body>
</html>