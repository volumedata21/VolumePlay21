<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VolumePlay21</title>
    
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/intersect@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    
    <script src="/static/js/app.js"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="shortcut icon" href="/static/favicon/favicon.ico">
    <link rel="stylesheet" href="/static/css/style.css">
    
    <style>
        .yt-icon:hover { color: #FF0000 !important; }
        .aspect-box { position: relative; width: 100%; background-color: var(--bg-highlight); transition: padding-top 0.3s ease-in-out; }
        .aspect-16-9 { padding-top: 56.25%; }
        .aspect-9-16 { padding-top: 177.78%; }
        /* Fix for Alpine's x-collapse animation */
        [x-collapse] { overflow: hidden; transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        [x-cloak] { display: none !important; }
    </style>
</head>

<body class="bg-[var(--bg-darkest)] text-[var(--text-main)]" x-data="videoApp" x-init="init()"
    :class="{ 'overflow-hidden': isMobileMenuOpen || isModalOpen || isPlaylistModalOpen || isSmartPlaylistModalOpen }"
    @save-smart-playlist-filters.window="saveSmartPlaylistSettings($event.detail)"
    @keydown.window.arrow-right="if(isModalOpen) playNextVideo()"
    @keydown.window.arrow-left="if(isModalOpen) playPreviousVideo()">
    
    <div x-show="isMobileMenuOpen" @click="isMobileMenuOpen = false"
        x-transition:enter="transition-opacity ease-in-out duration-300" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="transition-opacity ease-in-out duration-300"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
        class="fixed inset-0 z-30 bg-black/60 lg:hidden" x-cloak></div>

    <div class="flex h-screen">

        {% include 'partials/_sidebar.html' %}

        <main class="flex-1 overflow-y-auto transition-all duration-300" 
              :class="{'lg:pl-72': isDesktopSidebarOpen, 'lg:pl-0': !isDesktopSidebarOpen}">
            
            {% include 'partials/_header.html' %}

            <div class="grid grid-cols-1 gap-6 p-4" x-cloak :class="{
                    'sm:grid-cols-2 lg:grid-cols-3': currentView.type !== 'shorts',
                    'sm:grid-cols-3 lg:grid-cols-5': currentView.type === 'shorts'
                   }">
                <template x-if="filteredVideos.length === 0">
                    <p class="text-[var(--text-secondary)]" x-text="getEmptyMessage()"></p>
                </template>

                <template x-for="video in filteredVideos" :key="video.id">
                    {% include 'partials/_video_card.html' %}
                </template>
            </div>

            <div x-show="!isLoading && (currentPage <= totalPages) && currentView.type !== 'smart_playlist' && currentView.type !== 'standard_playlist'"
                 x-intersect.margin.200px="loadMoreVideos()" 
                 class="py-8 text-center w-full" 
                 x-cloak>
                 <span class="text-xs text-[var(--text-secondary)] animate-pulse">
                    Loading more videos...
                 </span>
            </div>

            <div class="pb-8 text-center" x-show="isLoading" x-cloak>
                <span class="material-icons animate-spin text-[var(--text-highlight)]"
                    style="font-size: 40px;">sync</span>
            </div>
        </main>
    </div>

    {% include 'partials/_video_modal.html' %}
    {% include 'partials/_playlist_modal.html' %}
    {% include 'partials/_smart_playlist_modal.html' %}

</body>
</html>